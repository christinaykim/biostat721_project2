---
title: "Biostat 721 Project 2"
author: "Christina Kim"
output: word_document
date: "2025-11-17"
---

```{r setup, echo=FALSE, warning = FALSE, message = FALSE}
library(dplyr)
library(tidyr)
library(stringr)
library(readr)
library(lubridate)
library(ggplot2)
```

```{r upload data, echo=FALSE}
data_2018 = read.csv("project 2 data/AQ_2018.csv")
data_2019 = read.csv("project 2 data/AQ_2019.csv")
data_2020 = read.csv("project 2 data/AQ_2020.csv")
```

```{r function, echo=FALSE}
clean_func = function(data) { 
  data %>% 
    # Rename pollutant concentration columns
    rename(
      co = "Daily.Max.8.hour.CO.Concentration",
      pm25 = "Daily.Mean.PM2.5.Concentration",
      o3 = "Daily.Max.8.hour.Ozone.Concentration"
    ) %>%
    # Format date variable
    mutate(
      Date = mdy(Date)      
    ) %>%
    # When pollutants are negative -> set them to 0
    mutate(                
      co = if_else(co < 0, 0, co),
      pm25 = if_else(pm25 < 0, 0, pm25),
      o3 = if_else(o3 < 0, 0, o3)
    ) %>%
    # One row per day by taking the daily average
     group_by(Date) %>%     
    summarise(
      co = mean(co, na.rm = TRUE),
      pm25 = mean(pm25, na.rm = TRUE),
      o3 = mean(o3, na.rm = TRUE),
      .groups = "drop"
    ) %>%
    # Remove duplicates
    distinct() %>%
    # Select only important columns
    select(c(Date,co, pm25, o3))     
  }
```

```{r clean data, echo=FALSE}
clean_2018 = clean_func(data_2018)
clean_2019 = clean_func(data_2019)
clean_2020 = clean_func(data_2020)
```

```{r combine data, echo=FALSE}
all_data = bind_rows(
  clean_2018 %>% mutate(
    year = 2018,
    month = month(Date, label = TRUE)),
  clean_2019 %>% mutate(
    year = 2019,
    month = month(Date, label = TRUE)),
  clean_2020 %>% mutate(
    year = 2020,
    month = month(Date, label = TRUE))
)
```

```{r monthly avg, echo=FALSE}
# monthly avg and standard error of co and o3 across all three years
monthly_avg <- all_data %>%
  group_by(month) %>%
  summarise(
    co_mean = mean(co, na.rm = TRUE),
    co_se   = sd(co, na.rm = TRUE) / sqrt(sum(!is.na(co))),
    o3_mean = mean(o3, na.rm = TRUE),
    o3_se   = sd(o3, na.rm = TRUE) / sqrt(sum(!is.na(o3)))
  ) %>%
  # gather long for ggplot
  tidyr::pivot_longer(cols = c(co_mean, o3_mean, co_se, o3_se),
                      names_to = c("pollutant", ".value"),
                      names_pattern = "(.*)_(mean|se)")
```

# Plot 1
```{r plot 1, echo=FALSE}
ggplot(monthly_avg, aes(x = month, y = mean, color = pollutant, group = pollutant)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  geom_errorbar(aes(ymin = mean - 1.96 * se, ymax = mean + 1.96 * se), width = 0.2) +
  scale_color_manual(values = c("co" = "#1b9e77", "o3" = "#d95f02"),
                     labels = c("CO", expression("O"[3]*""))) +
  labs(
    title = expression("Monthly Average CO and O"[3]*" Concentrations (2018–2020)"),
    x = "Month",
    y = "Concentration (ppm)",
    color = "Pollutant" 
  ) +
  theme_minimal(base_size = 10.5)
```

```{r pm2.5 monthly avg, echo=FALSE}
#PM2.5 monthly average for each of the three years
pm_monthly <- all_data %>%
  group_by(year, month) %>%
  summarise(pm25_mean = mean(pm25, na.rm = TRUE), .groups = "drop")
```

# Plot 2
```{r plot 2, echo=FALSE}
ggplot(pm_monthly, aes(x = month, y = pm25_mean, group = 1, color = factor(year))) +
  geom_line(linewidth = 0.5) +
  geom_point(size = 1.5) +
  scale_color_viridis_d(name = "Year") +
  facet_wrap(~ year, ncol = 1, scales = "free_y") +  # facet by year
  labs(
    title = expression("Monthly Average PM"[2.5]*" Concentration by Year"),
    x = "Month",
    y = expression("PM"[2.5]*" Concentration (µg/m³)")
  ) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = "none",         # remove legend since year is faceted
    strip.text = element_text(face = "bold", size = 12),
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5)
  )
```

